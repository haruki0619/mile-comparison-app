# 品質保証チェックリスト
## Quality Assurance Checklist

**用途**: 新機能追加・修正時の品質確認  
**必須確認項目**: 全てチェック後にリリース可能

---

## ✅ 1. 型安全性チェック

### 1.1 TypeScript コンパイル
- [ ] `npm run build` が正常終了する
- [ ] TypeScript strict errors が 0 件
- [ ] ESLint warnings が 5 件以下
- [ ] 新しい `any` 型の使用がない

### 1.2 型定義の一貫性
- [ ] 新しいインターフェースが適切なモジュールに配置されている
- [ ] `RouteData`, `SearchResult`, `AirlineMileInfo` 型が統一されている
- [ ] オプショナルプロパティ（`?:`）が適切に設定されている
- [ ] 循環参照（circular dependency）が発生していない

### 1.3 航空会社型の厳密性 ⭐ **新規追加**
- [ ] `GlobalMileChart` で any型を使用していない
- [ ] 各航空会社（ANA, JAL, UA, AA, DL, LH, BA, AF, SQ, CX, TG, QR, EK）の型が定義されている
- [ ] 航空会社別の特徴的プロパティ（dynamicPricing, excursionist等）が型定義に含まれている
- [ ] `AirlineCode`, `AnyAirlineMileChart`, `AirlineMileChartByCode` ヘルパー型が定義されている
- [ ] UIコンポーネントで航空会社ごとの型安全な表示が可能である

**確認コマンド**:
```bash
npm run build
npm run lint

# 型定義確認
grep -r "any" src/types/airlines.ts  # any型が残っていないか確認
```

---

## ✅ 2. UI表示安全性チェック

### 2.1 null/undefined 対策
- [ ] 全ての `.toLocaleString()` 呼び出しに型ガードがある
- [ ] 配列操作（map, filter）で null チェックがある
- [ ] オブジェクトプロパティアクセスでオプショナルチェーン（`?.`）を使用
- [ ] 数値表示で `|| 0` フォールバック値がある

### 2.2 エラー境界
- [ ] 新しいコンポーネントが Error Boundary で保護されている
- [ ] エラー発生時のフォールバック UI が実装されている
- [ ] ユーザーに分かりやすいエラーメッセージがある

**テスト方法**:
```bash
# 開発サーバー起動
npm run dev

# ブラウザで以下を確認:
# - 正常な検索結果表示
# - 異常データでのエラー非発生
# - フォールバック表示の動作
```

---

## ✅ 3. データ品質・ファクトチェック

### 3.1 公式情報の確認
- [ ] 新しいマイレージプログラム情報に公式URL・根拠がある
- [ ] 必要マイル数が最新の公式情報と一致している
- [ ] 特典航空券の予約条件が正確である
- [ ] 為替レート・手数料情報が最新である

### 3.2 データ検証ステータス
- [ ] 新しいデータに検証ステータス（✅/🔄/❌）が付与されている
- [ ] 「未検証」データは UI で明示されている
- [ ] フォールバックデータ使用時は明確に表示されている
- [ ] 最終更新日時が記録されている

**確認リソース**:
- ANA: https://www.ana.co.jp/ja/jp/amc/
- JAL: https://www.jal.co.jp/jmb/
- United: https://www.united.com/ual/en/us/fly/mileageplus/

---

## ✅ 4. API・外部データ統合

### 4.1 API 応答処理
- [ ] API 失敗時のフォールバック処理がある
- [ ] タイムアウト設定が適切である（5-10秒）
- [ ] レスポンス データの検証処理がある
- [ ] エラーログが適切に出力されている

### 4.2 キャッシュ・パフォーマンス
- [ ] 同一検索条件での重複API呼び出しがない
- [ ] 重いデータ処理でローディング表示がある
- [ ] メモリリークの原因となるコードがない

**テストコマンド**:
```bash
# API 接続テスト
curl -X POST http://localhost:3001/api/flights/search \
  -H "Content-Type: application/json" \
  -d '{"departure":"NRT","arrival":"ITM","date":"2025-09-25","passengers":1}'
```

---

## ✅ 5. モジュール構造・保守性

### 5.1 ファイル組織
- [ ] 新しいファイルが適切なディレクトリに配置されている
- [ ] ファイル名が命名規則に従っている
- [ ] import/export が整理されている
- [ ] 未使用のコードが削除されている

### 5.2 コメント・ドキュメント
- [ ] 複雑なロジックにコメントがある
- [ ] 新しい型定義に説明コメントがある
- [ ] README.md が最新情報に更新されている
- [ ] 設計書に変更内容が反映されている

**構造確認**:
```
src/
├── types/           ✅ 型定義の分離
├── components/      ✅ UI コンポーネント
├── services/        ✅ API・ビジネスロジック
├── utils/          ✅ ユーティリティ関数
└── data/           ✅ 静的データ
```

---

## ✅ 6. ユーザー体験

### 6.1 操作性
- [ ] 検索結果表示が3秒以内に完了する
- [ ] ローディング状態が適切に表示される
- [ ] エラー時もアプリケーションが操作可能である
- [ ] モバイル表示が崩れていない

### 6.2 情報の透明性
- [ ] マイル計算根拠が表示されている
- [ ] データ取得ソースが明示されている
- [ ] 最終更新日時が表示されている
- [ ] 「検証済み」「未検証」の区別がある

**ユーザビリティテスト**:
- [ ] 初回ユーザーが5分以内に検索を完了できる
- [ ] 検索結果の比較理由が理解できる
- [ ] エラー時の対処法が明確である

---

## ✅ 7. セキュリティ・プライバシー

### 7.1 機密情報管理
- [ ] API キーが環境変数で管理されている
- [ ] ハードコードされた認証情報がない
- [ ] ログに個人情報が出力されていない
- [ ] サーバーサイドでの適切な検証がある

### 7.2 データ保護
- [ ] ユーザー入力の適切なサニタイズがある
- [ ] XSS 攻撃対策が実装されている
- [ ] 個人情報の最小限収集を徹底している

---

## ✅ 8. パフォーマンス

### 8.1 読み込み速度
- [ ] 初期表示が2秒以内に完了する
- [ ] バンドルサイズが適切（<1MB）である
- [ ] 不要なライブラリがインポートされていない
- [ ] 画像・リソースが最適化されている

### 8.2 計算処理
- [ ] 大量データでの処理速度が許容範囲である
- [ ] メモリ使用量が適切である
- [ ] 無限ループ・重い処理がない

**パフォーマンステスト**:
```bash
npm run build
npm run start

# Lighthouse スコア確認:
# - Performance: >90
# - Accessibility: >95
# - Best Practices: >90
```

---

## ✅ 9. 互換性・ブラウザ対応

### 9.1 ブラウザテスト
- [ ] Chrome（最新版）で正常動作
- [ ] Firefox（最新版）で正常動作  
- [ ] Safari（最新版）で正常動作
- [ ] Edge（最新版）で正常動作

### 9.2 デバイス対応
- [ ] デスクトップ（1920x1080）で正常表示
- [ ] タブレット（768x1024）で正常表示
- [ ] スマートフォン（375x667）で正常表示

---

## ✅ 10. リリース前最終確認

### 10.1 機能テスト
- [ ] 全ての検索パターンで結果が表示される
- [ ] マイル比較計算が正確である
- [ ] 価格比較が正常に動作する
- [ ] エクスポート・共有機能が動作する

### 10.2 エラーシナリオ
- [ ] ネットワーク切断時の挙動
- [ ] 不正な入力値での挙動
- [ ] API 制限時の挙動
- [ ] 大量データ処理時の挙動

### 10.3 文書化
- [ ] 変更履歴が記録されている
- [ ] 既知の問題・制限事項が文書化されている
- [ ] ユーザーガイドが更新されている
- [ ] 開発者ドキュメントが最新である

---

## 📋 チェック完了の確認

**全項目完了後の最終確認**:

```bash
# 1. ビルド確認
npm run build

# 2. 型チェック
npm run type-check

# 3. リント確認  
npm run lint

# 4. テスト実行
npm run test

# 5. 本番環境デプロイテスト
npm run start
```

**✅ 全チェック完了** → **リリース承認可能**

---

## 🔄 継続的改善

### 定期確認項目（週次）
- [ ] 依存関係の脆弱性チェック
- [ ] パフォーマンス監視結果の確認
- [ ] ユーザーフィードバックの反映
- [ ] 公式情報の更新確認

### 定期確認項目（月次）
- [ ] 全マイレージプログラムの情報更新
- [ ] セキュリティパッチの適用
- [ ] ブラウザ対応状況の確認  
- [ ] アクセシビリティ改善

---

*このチェックリストは開発チーム全員で共有し、リリース品質の保証に活用する*
